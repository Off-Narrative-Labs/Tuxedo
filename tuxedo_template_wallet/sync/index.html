<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module is responsible for maintaining the walletâ€™s local database of blocks and owned UTXOs to the canonical database reported by the node."><title>tuxedo_template_wallet::sync - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-9ee3a5e31a2afa3e.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="tuxedo_template_wallet" data-themes="" data-resource-suffix="" data-rustdoc-version="1.75.0-nightly (189d6c71f 2023-11-06)" data-channel="nightly" data-search-js="search-8fbf244ebcf71464.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-9dd44ab47b99a0fb.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../tuxedo_template_wallet/index.html">tuxedo_template_wallet</a><span class="version">1.0.0-dev</span></h2></div><h2 class="location"><a href="#">Module sync</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate tuxedo_template_wallet</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press â€˜Sâ€™ to search, â€˜?â€™ for more optionsâ€¦" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">tuxedo_template_wallet</a>::<wbr><a class="mod" href="#">sync</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/tuxedo_template_wallet/sync.rs.html#1-519">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module is responsible for maintaining the walletâ€™s local database of blocks
and owned UTXOs to the canonical database reported by the node.</p>
<p>It is backed by a sled database</p>
<h3 id="schema"><a href="#schema">Schema</a></h3>
<p>There are 4 tables in the database
BlockHashes     block_number:u32 =&gt; block_hash:H256
Blocks          block_hash:H256 =&gt; block:Block
UnspentOutputs  output_ref =&gt; (owner_pubkey, amount)
SpentOutputs    output_ref =&gt; (owner_pubkey, amount)</p>
</div></details><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.BLOCKS.html" title="constant tuxedo_template_wallet::sync::BLOCKS">BLOCKS</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">The identifier for the blocks tree in the db.</div></li><li><div class="item-name"><a class="constant" href="constant.BLOCK_HASHES.html" title="constant tuxedo_template_wallet::sync::BLOCK_HASHES">BLOCK_HASHES</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">The identifier for the block_hashes tree in the db.</div></li><li><div class="item-name"><a class="constant" href="constant.NUM_GENESIS_UTXOS.html" title="constant tuxedo_template_wallet::sync::NUM_GENESIS_UTXOS">NUM_GENESIS_UTXOS</a></div><div class="desc docblock-short">TODO remove this constant. Instead we should just iterate output refs until we find one that doesnâ€™t exist.</div></li><li><div class="item-name"><a class="constant" href="constant.SPENT.html" title="constant tuxedo_template_wallet::sync::SPENT">SPENT</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">The identifier for the spent tree in the db.</div></li><li><div class="item-name"><a class="constant" href="constant.UNSPENT.html" title="constant tuxedo_template_wallet::sync::UNSPENT">UNSPENT</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">The identifier for the unspent tree in the db.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.add_unspent_output.html" title="fn tuxedo_template_wallet::sync::add_unspent_output">add_unspent_output</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Add a new output to the database updating all tables.</div></li><li><div class="item-name"><a class="fn" href="fn.apply_block.html" title="fn tuxedo_template_wallet::sync::apply_block">apply_block</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Apply a block to the local database</div></li><li><div class="item-name"><a class="fn" href="fn.apply_transaction.html" title="fn tuxedo_template_wallet::sync::apply_transaction">apply_transaction</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Apply a single transaction to the local database
The owner-specific tables are mappings from output_refs to coin amounts</div></li><li><div class="item-name"><a class="fn" href="fn.get_arbitrary_unspent_set.html" title="fn tuxedo_template_wallet::sync::get_arbitrary_unspent_set">get_arbitrary_unspent_set</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Picks an arbitrary set of unspent outputs from the database for spending.
The setâ€™s token values must add up to at least the specified target value.</div></li><li><div class="item-name"><a class="fn" href="fn.get_balances.html" title="fn tuxedo_template_wallet::sync::get_balances">get_balances</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Iterate the entire unspent set summing the values of the coins
on a per-address basis.</div></li><li><div class="item-name"><a class="fn" href="fn.get_block.html" title="fn tuxedo_template_wallet::sync::get_block">get_block</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Gets the block from the local database given a block hash. Similar to the Nodeâ€™s RPC.</div></li><li><div class="item-name"><a class="fn" href="fn.get_block_hash.html" title="fn tuxedo_template_wallet::sync::get_block_hash">get_block_hash</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Gets the block hash from the local database given a block height. Similar the Nodeâ€™s RPC.</div></li><li><div class="item-name"><a class="fn" href="fn.get_unspent.html" title="fn tuxedo_template_wallet::sync::get_unspent">get_unspent</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Gets the owner and amount associated with an output ref from the unspent table</div></li><li><div class="item-name"><a class="fn" href="fn.height.html" title="fn tuxedo_template_wallet::sync::height">height</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Get the block height that the wallet is currently synced to</div></li><li><div class="item-name"><a class="fn" href="fn.init_from_genesis.html" title="fn tuxedo_template_wallet::sync::init_from_genesis">init_from_genesis</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div></li><li><div class="item-name"><a class="fn" href="fn.open_db.html" title="fn tuxedo_template_wallet::sync::open_db">open_db</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Open a database at the given location intended for the given genesis block.</div></li><li><div class="item-name"><a class="fn" href="fn.print_block_hashes_tree.html" title="fn tuxedo_template_wallet::sync::print_block_hashes_tree">print_block_hashes_tree</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Debugging use. Print out the entire block_hashes tree.</div></li><li><div class="item-name"><a class="fn" href="fn.print_unspent_tree.html" title="fn tuxedo_template_wallet::sync::print_unspent_tree">print_unspent_tree</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Debugging use. Print the entire unspent outputs tree.</div></li><li><div class="item-name"><a class="fn" href="fn.remove_unspent_output.html" title="fn tuxedo_template_wallet::sync::remove_unspent_output">remove_unspent_output</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Remove an output from the database updating all tables.</div></li><li><div class="item-name"><a class="fn" href="fn.spend_output.html" title="fn tuxedo_template_wallet::sync::spend_output">spend_output</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Mark an existing output as spent. This does not purge all record of the output from the db.
It just moves the record from the unspent table to the spent table</div></li><li><div class="item-name"><a class="fn" href="fn.synchronize.html" title="fn tuxedo_template_wallet::sync::synchronize">synchronize</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Synchronize the local database to the database of the running node.
The wallet entirely trusts the data the node feeds it. In the bigger
picture, that means run your own (light) node.</div></li><li><div class="item-name"><a class="fn" href="fn.unapply_highest_block.html" title="fn tuxedo_template_wallet::sync::unapply_highest_block">unapply_highest_block</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Unapply the best block that the wallet currently knows about</div></li><li><div class="item-name"><a class="fn" href="fn.unapply_transaction.html" title="fn tuxedo_template_wallet::sync::unapply_transaction">unapply_transaction</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Run a transaction backwards against a database. Mark all of the Inputs
as unspent, and drop all of the outputs.</div></li><li><div class="item-name"><a class="fn" href="fn.unspend_output.html" title="fn tuxedo_template_wallet::sync::unspend_output">unspend_output</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Mark an output that was previously spent back as unspent.</div></li></ul></section></div></main></body></html>