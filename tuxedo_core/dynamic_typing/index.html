<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Dynamic Typing utilities for Tuxedo runtimes"><title>tuxedo_core::dynamic_typing - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-9ee3a5e31a2afa3e.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="tuxedo_core" data-themes="" data-resource-suffix="" data-rustdoc-version="1.76.0-nightly (2f8d81f9d 2023-11-21)" data-channel="nightly" data-search-js="search-21db098bdc95be9e.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-f06f02fd918e3bb3.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../tuxedo_core/index.html">tuxedo_core</a><span class="version">1.0.0-dev</span></h2></div><h2 class="location"><a href="#">Module dynamic_typing</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section><h2><a href="../index.html">In crate tuxedo_core</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">tuxedo_core</a>::<wbr><a class="mod" href="#">dynamic_typing</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/tuxedo_core/dynamic_typing.rs.html#1-214">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Dynamic Typing utilities for Tuxedo runtimes</p>
<h2 id="motivation"><a href="#motivation">Motivation</a></h2>
<p>In Tuxedo, UTXOs are like envelopes that store to later be opened and computed on.
These data can be of many different types depending on which Tuxedo pieces may
operate on them. And different Tuxedo runtimes may support different data types.</p>
<p>In order to support type safety as well as serialization, we must do some dynamic
type checking when a UTXO is taken out of storage to ensure that the data is decoded
to the same type from which it was encoded. This is important because it will occasionally
be the case that serialized data may validly decode to more than one type.</p>
<h2 id="example-attack"><a href="#example-attack">Example Attack</a></h2>
<p>To understand the importance of the type checking, consider a concrete Tuxedo runtime that
has both a bitcoin-like cryptocurrency and a crypto-kitties-like NFT game. Imagine a user
spends a moderate amount of money breeding cryptokitties until they have an Attack Kitty.
And Attack Kitty is one whose serialized data has the property that it would also validly
decode into a coin in the cryptocurrency and spent accordingly. In the worst case (best for
the attacker) the value of the coin would exceed the value spent breeding the cryptokitties.</p>
<h2 id="methodology"><a href="#methodology">Methodology</a></h2>
<p>To solve this problem we associate a four-byte type identifier with each data type that can
be stored in a UTXO. When a UTXO is stored, the type identifier is stored along with the
serialized data. When the UTXO is later read from storage, the type identifier is checked
against the type into which the data is being decoded. Currently this read-time checking
is the job of the piece developer, although that may be able to improve in the future.</p>
<h2 id="comparison-with-sp_stdany"><a href="#comparison-with-sp_stdany">Comparison with <code>sp_std::any</code></a></h2>
<p>The Rust standard library, and also the <code>sp-std</code> crate offer utilities for dynamic typing
as well. We have considered and are still considering using that crate instead of these
custom utilities.</p>
<h3 id="in-favor-of-sp_stdany"><a href="#in-favor-of-sp_stdany">In favor of <code>sp_std::any</code></a></h3>
<ul>
<li>The compiler guarantees unique type ids for every type, whereas this utility
requires the developer to avoid collisions (hopefully macros can improve this slightly)</li>
<li>Using that crate would be less code for Tuxedo developers to maintain</li>
</ul>
<h3 id="in-favor-of-this-custom-utility"><a href="#in-favor-of-this-custom-utility">In favor of this custom utility</a></h3>
<ul>
<li><code>sp_std::any</code> does not make the type_id public. This makes it impossible to encode it
and store it along with the serialized data which is the whole point. This could be <em>hacked</em>
around by, for example, hashing the Debug strong, but that is ugly</li>
</ul>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="testing/index.html" title="mod tuxedo_core::dynamic_typing::testing">testing</a></div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.DynamicallyTypedData.html" title="struct tuxedo_core::dynamic_typing::DynamicallyTypedData">DynamicallyTypedData</a></div><div class="desc docblock-short">A piece of encoded data with a type id associated
Strongly typed data can be extracted</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.DynamicTypingError.html" title="enum tuxedo_core::dynamic_typing::DynamicTypingError">DynamicTypingError</a></div><div class="desc docblock-short">Errors that can occur when casting dynamically typed data into strongly typed data.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.UtxoData.html" title="trait tuxedo_core::dynamic_typing::UtxoData">UtxoData</a></div><div class="desc docblock-short">A trait that must be implemented for any data that can be contained in a UTXO.
It is not recommended to implement this trait directly for primitive types, but rather to
use the newtype pattern: https://doc.rust-lang.org/book/ch19-04-advanced-types.html.
Using a new type allows strong type disambiguation between bespoke use-cases in which
the same primitive may be stored.</div></li></ul></section></div></main></body></html>